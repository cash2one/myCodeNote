 # 内存管理方案
` 这里关于内存管理的讨论全部基于objc-runtime-680 `
# iOS操作系统是怎样对内存进行管理的?

针对不同场景会有不同的管理方案. 

## 场景:

- 1.TaggedPointer: 对于一些小对象,比如说NSNumber等, 对于这些小对象采用的就是TaggedPointer这种管理方案

- 2. NONPOINTER_ISA: 对于64架构下的应用程序采用的是`NONPOINTER_ISA`
  - 实际在64位架构下 ISA这个指针是占64个比特位的. 但是实际上有32位或者说40位就够用了.剩余的一些比特位是浪费的.苹果为了提搞内存的利用率, 在ISA当中剩余的这些比特位存储了关于内存管理方面数据内容. 所以这个叫做`非指针型的ISA `

- 3. 散列表: 复杂的数据结构,这里面包括了 `引用计数表` 和 ` 弱引用表`

 
# 非指针型的isa NONPOINTER_ISA 内存管理方案

在arm64架构下, isa指针一共有64个比特位, 我们来看看这64个比特位都存了那些内容

# 首先来看0~15位

- 第一位indexed
  - 图中第一位是一个叫indexed的标志位,  如果是0就表示这个isa指针是一个存的isa指针, 就是说这个isa指针就是当前对象的类对象的地址

  - 如果是1的话就表示这个isa指针存的内 容不仅仅是类对象的地址,  他里面还有一些关于内存管理方面的数据, 

- 第二位has_accoc(是否有关联对象)
 - 0就代表没有, 1就代表有

- 第三位has_cxx_dtor (这个函数或者这个变量标志表示的是当前对象是否有使用到c++相关的一些代码,或者c++语言方面的一些内容)
  - 在ARC当中, 实际上也可以通过这个标志位来表示有些对象是通过ARC来进行内存管理 的

